from string import Template
import os
from collections import OrderedDict
import AnalyticsService.Util
import logging
DIR_NAME = os.path.dirname(__file__)
logger = logging.getLogger(__name__)
import json
#
# dataSource = {
#     "chart": {
#         "bgColor": "#000000,#000000",
#         "caption": "Monthly revenue for last year",
#         "subCaption": "Harry's SuperMart",
#         "xAxisName": "Month",
#         "yAxisName": "Revenues (In USD)",
#         "numberPrefix": "$",
#         "canvasBgAlpha": "0",
#         "bgAlpha": "100",
#         "theme": "fint",
#         "exportEnabled": "1",
#
#         "captionFont": "Verdana",
#         "captionFontSize": "30",
#         "captionFontColor": "#FFFFFF",
#         "captionFontBold": "1",
#         "subcaptionFont": "Verdana",
#         "subcaptionFontSize": "25",
#         "subcaptionFontColor": "#FFFFFF",
#         "subcaptionFontBold": "0",
#         "baseFont": "Verdana",
#         "baseFontSize": "20",
#         "baseFontColor": "#FFFFFF",
#         "plotFillAlpha": "50"
#     },
#     # "data": data
# }
# #
d = {
    "data": [
        {
            "_id": "imwithher",
            "count": 47964
        },
        {
            "_id": "feelthebern",
            "count": 39029
        },
        {
            "_id": "makeamericagreatagain",
            "count": 36757
        },
        {
            "_id": "trump2016",
            "count": 17056
        },
        {
            "_id": "bernieorbust",
            "count": 10287
        },
        {
            "_id": "trumptrain",
            "count": 8181
        },
        {
            "_id": "neverhillary",
            "count": 7692
        },
        {
            "_id": "stillsanders",
            "count": 7272
        },
        {
            "_id": "stoptpp",
            "count": 5530
        },
        {
            "_id": "americafirst",
            "count": 5195
        }
    ],
    "details": {
        "chartType": "bar2d",
        "chartProperties":{"yAxisName":"Number of Occurences",
                           "xAxisName":"Hashtag",
                           "defaultCenterLabel":"Top Hashtags"}
    }
}
#
# d = {
#     "data": {
#         "categories": [
#             "2016-06-28T18:00:00Z",
#             "2016-06-28T19:00:00Z",
#             "2016-06-28T20:00:00Z",
#             "2016-06-28T21:00:00Z",
#             "2016-06-28T22:00:00Z",
#             "2016-06-28T23:00:00Z",
#             "2016-06-29T11:00:00Z",
#             "2016-06-29T12:00:00Z",
#             "2016-06-29T13:00:00Z",
#             "2016-06-29T14:00:00Z",
#             "2016-06-29T15:00:00Z",
#             "2016-06-29T16:00:00Z",
#             "2016-06-29T17:00:00Z",
#             "2016-06-29T18:00:00Z",
#             "2016-06-29T19:00:00Z",
#             "2016-06-29T20:00:00Z",
#             "2016-06-29T21:00:00Z",
#             "2016-06-29T22:00:00Z",
#             "2016-06-29T23:00:00Z",
#             "2016-06-30T00:00:00Z",
#             "2016-06-30T01:00:00Z",
#             "2016-06-30T02:00:00Z",
#             "2016-06-30T03:00:00Z",
#             "2016-06-30T04:00:00Z",
#             "2016-06-30T05:00:00Z",
#             "2016-06-30T06:00:00Z",
#             "2016-06-30T07:00:00Z",
#             "2016-06-30T08:00:00Z",
#             "2016-06-30T09:00:00Z",
#             "2016-06-30T10:00:00Z",
#             "2016-06-30T11:00:00Z",
#             "2016-06-30T12:00:00Z",
#             "2016-06-30T13:00:00Z",
#             "2016-06-30T14:00:00Z",
#             "2016-06-30T15:00:00Z",
#             "2016-06-30T16:00:00Z",
#             "2016-06-30T17:00:00Z",
#             "2016-06-30T18:00:00Z",
#             "2016-06-30T19:00:00Z",
#             "2016-06-30T20:00:00Z",
#             "2016-06-30T21:00:00Z",
#             "2016-06-30T22:00:00Z",
#             "2016-06-30T23:00:00Z",
#             "2016-07-01T00:00:00Z",
#             "2016-07-01T01:00:00Z",
#             "2016-07-01T02:00:00Z",
#             "2016-07-01T03:00:00Z",
#             "2016-07-01T08:00:00Z",
#             "2016-07-03T19:00:00Z"
#         ],
#         "values": [
#             {
#                 "_id": "makeamericagreatagain",
#                 "data": [
#                     {
#                         "count": 429,
#                         "dt": "2016-06-28T18:00:00Z"
#                     },
#                     {
#                         "count": 914,
#                         "dt": "2016-06-28T19:00:00Z"
#                     },
#                     {
#                         "count": 1099,
#                         "dt": "2016-06-28T20:00:00Z"
#                     },
#                     {
#                         "count": 843,
#                         "dt": "2016-06-28T21:00:00Z"
#                     },
#                     {
#                         "count": 788,
#                         "dt": "2016-06-28T22:00:00Z"
#                     },
#                     {
#                         "count": 467,
#                         "dt": "2016-06-28T23:00:00Z"
#                     },
#                     {
#                         "count": 203,
#                         "dt": "2016-06-29T11:00:00Z"
#                     },
#                     {
#                         "count": 589,
#                         "dt": "2016-06-29T12:00:00Z"
#                     },
#                     {
#                         "count": 928,
#                         "dt": "2016-06-29T13:00:00Z"
#                     },
#                     {
#                         "count": 1054,
#                         "dt": "2016-06-29T14:00:00Z"
#                     },
#                     {
#                         "count": 880,
#                         "dt": "2016-06-29T15:00:00Z"
#                     },
#                     {
#                         "count": 694,
#                         "dt": "2016-06-29T16:00:00Z"
#                     },
#                     {
#                         "count": 648,
#                         "dt": "2016-06-29T17:00:00Z"
#                     },
#                     {
#                         "count": 590,
#                         "dt": "2016-06-29T18:00:00Z"
#                     },
#                     {
#                         "count": 776,
#                         "dt": "2016-06-29T19:00:00Z"
#                     },
#                     {
#                         "count": 795,
#                         "dt": "2016-06-29T20:00:00Z"
#                     },
#                     {
#                         "count": 880,
#                         "dt": "2016-06-29T21:00:00Z"
#                     },
#                     {
#                         "count": 1008,
#                         "dt": "2016-06-29T22:00:00Z"
#                     },
#                     {
#                         "count": 1205,
#                         "dt": "2016-06-29T23:00:00Z"
#                     },
#                     {
#                         "count": 872,
#                         "dt": "2016-06-30T00:00:00Z"
#                     },
#                     {
#                         "count": 1268,
#                         "dt": "2016-06-30T01:00:00Z"
#                     },
#                     {
#                         "count": 1045,
#                         "dt": "2016-06-30T02:00:00Z"
#                     },
#                     {
#                         "count": 777,
#                         "dt": "2016-06-30T03:00:00Z"
#                     },
#                     {
#                         "count": 820,
#                         "dt": "2016-06-30T04:00:00Z"
#                     },
#                     {
#                         "count": 734,
#                         "dt": "2016-06-30T05:00:00Z"
#                     },
#                     {
#                         "count": 548,
#                         "dt": "2016-06-30T06:00:00Z"
#                     },
#                     {
#                         "count": 344,
#                         "dt": "2016-06-30T07:00:00Z"
#                     },
#                     {
#                         "count": 313,
#                         "dt": "2016-06-30T08:00:00Z"
#                     },
#                     {
#                         "count": 286,
#                         "dt": "2016-06-30T09:00:00Z"
#                     },
#                     {
#                         "count": 396,
#                         "dt": "2016-06-30T10:00:00Z"
#                     },
#                     {
#                         "count": 597,
#                         "dt": "2016-06-30T11:00:00Z"
#                     },
#                     {
#                         "count": 696,
#                         "dt": "2016-06-30T12:00:00Z"
#                     },
#                     {
#                         "count": 813,
#                         "dt": "2016-06-30T13:00:00Z"
#                     },
#                     {
#                         "count": 1154,
#                         "dt": "2016-06-30T14:00:00Z"
#                     },
#                     {
#                         "count": 862,
#                         "dt": "2016-06-30T15:00:00Z"
#                     },
#                     {
#                         "count": 885,
#                         "dt": "2016-06-30T16:00:00Z"
#                     },
#                     {
#                         "count": 867,
#                         "dt": "2016-06-30T17:00:00Z"
#                     },
#                     {
#                         "count": 715,
#                         "dt": "2016-06-30T18:00:00Z"
#                     },
#                     {
#                         "count": 806,
#                         "dt": "2016-06-30T19:00:00Z"
#                     },
#                     {
#                         "count": 705,
#                         "dt": "2016-06-30T20:00:00Z"
#                     },
#                     {
#                         "count": 697,
#                         "dt": "2016-06-30T21:00:00Z"
#                     },
#                     {
#                         "count": 999,
#                         "dt": "2016-06-30T22:00:00Z"
#                     },
#                     {
#                         "count": 1164,
#                         "dt": "2016-06-30T23:00:00Z"
#                     },
#                     {
#                         "count": 966,
#                         "dt": "2016-07-01T00:00:00Z"
#                     },
#                     {
#                         "count": 873,
#                         "dt": "2016-07-01T01:00:00Z"
#                     },
#                     {
#                         "count": 1016,
#                         "dt": "2016-07-01T02:00:00Z"
#                     },
#                     {
#                         "count": 745,
#                         "dt": "2016-07-01T03:00:00Z"
#                     },
#                     {
#                         "count": 4,
#                         "dt": "2016-07-03T19:00:00Z"
#                     }
#                 ]
#             },
#             {
#                 "_id": "stoptpp",
#                 "data": [
#                     {
#                         "count": 1,
#                         "dt": "2016-06-28T18:00:00Z"
#                     },
#                     {
#                         "count": 2,
#                         "dt": "2016-06-28T19:00:00Z"
#                     },
#                     {
#                         "count": 1,
#                         "dt": "2016-06-28T20:00:00Z"
#                     },
#                     {
#                         "count": 1,
#                         "dt": "2016-06-28T21:00:00Z"
#                     },
#                     {
#                         "count": 2,
#                         "dt": "2016-06-28T22:00:00Z"
#                     },
#                     {
#                         "count": 1,
#                         "dt": "2016-06-28T23:00:00Z"
#                     },
#                     {
#                         "count": 1,
#                         "dt": "2016-06-29T12:00:00Z"
#                     },
#                     {
#                         "count": 3,
#                         "dt": "2016-06-29T13:00:00Z"
#                     },
#                     {
#                         "count": 89,
#                         "dt": "2016-06-29T16:00:00Z"
#                     },
#                     {
#                         "count": 1555,
#                         "dt": "2016-06-29T17:00:00Z"
#                     },
#                     {
#                         "count": 246,
#                         "dt": "2016-06-29T18:00:00Z"
#                     },
#                     {
#                         "count": 82,
#                         "dt": "2016-06-29T19:00:00Z"
#                     },
#                     {
#                         "count": 91,
#                         "dt": "2016-06-29T20:00:00Z"
#                     },
#                     {
#                         "count": 66,
#                         "dt": "2016-06-29T21:00:00Z"
#                     },
#                     {
#                         "count": 22,
#                         "dt": "2016-06-29T22:00:00Z"
#                     },
#                     {
#                         "count": 270,
#                         "dt": "2016-06-29T23:00:00Z"
#                     },
#                     {
#                         "count": 416,
#                         "dt": "2016-06-30T00:00:00Z"
#                     },
#                     {
#                         "count": 559,
#                         "dt": "2016-06-30T01:00:00Z"
#                     },
#                     {
#                         "count": 1107,
#                         "dt": "2016-06-30T02:00:00Z"
#                     },
#                     {
#                         "count": 319,
#                         "dt": "2016-06-30T03:00:00Z"
#                     },
#                     {
#                         "count": 273,
#                         "dt": "2016-06-30T04:00:00Z"
#                     },
#                     {
#                         "count": 54,
#                         "dt": "2016-06-30T05:00:00Z"
#                     },
#                     {
#                         "count": 17,
#                         "dt": "2016-06-30T06:00:00Z"
#                     },
#                     {
#                         "count": 23,
#                         "dt": "2016-06-30T07:00:00Z"
#                     },
#                     {
#                         "count": 19,
#                         "dt": "2016-06-30T08:00:00Z"
#                     },
#                     {
#                         "count": 2,
#                         "dt": "2016-06-30T09:00:00Z"
#                     },
#                     {
#                         "count": 2,
#                         "dt": "2016-06-30T10:00:00Z"
#                     },
#                     {
#                         "count": 9,
#                         "dt": "2016-06-30T11:00:00Z"
#                     },
#                     {
#                         "count": 2,
#                         "dt": "2016-06-30T12:00:00Z"
#                     },
#                     {
#                         "count": 14,
#                         "dt": "2016-06-30T13:00:00Z"
#                     },
#                     {
#                         "count": 12,
#                         "dt": "2016-06-30T14:00:00Z"
#                     },
#                     {
#                         "count": 25,
#                         "dt": "2016-06-30T15:00:00Z"
#                     },
#                     {
#                         "count": 60,
#                         "dt": "2016-06-30T16:00:00Z"
#                     },
#                     {
#                         "count": 29,
#                         "dt": "2016-06-30T17:00:00Z"
#                     },
#                     {
#                         "count": 13,
#                         "dt": "2016-06-30T18:00:00Z"
#                     },
#                     {
#                         "count": 10,
#                         "dt": "2016-06-30T19:00:00Z"
#                     },
#                     {
#                         "count": 16,
#                         "dt": "2016-06-30T20:00:00Z"
#                     },
#                     {
#                         "count": 9,
#                         "dt": "2016-06-30T21:00:00Z"
#                     },
#                     {
#                         "count": 23,
#                         "dt": "2016-06-30T22:00:00Z"
#                     },
#                     {
#                         "count": 46,
#                         "dt": "2016-06-30T23:00:00Z"
#                     },
#                     {
#                         "count": 16,
#                         "dt": "2016-07-01T00:00:00Z"
#                     },
#                     {
#                         "count": 9,
#                         "dt": "2016-07-01T01:00:00Z"
#                     },
#                     {
#                         "count": 7,
#                         "dt": "2016-07-01T02:00:00Z"
#                     },
#                     {
#                         "count": 6,
#                         "dt": "2016-07-01T03:00:00Z"
#                     }
#                 ]
#             },
#             {
#                 "_id": "neverhillary",
#                 "data": [
#                     {
#                         "count": 92,
#                         "dt": "2016-06-28T18:00:00Z"
#                     },
#                     {
#                         "count": 139,
#                         "dt": "2016-06-28T19:00:00Z"
#                     },
#                     {
#                         "count": 217,
#                         "dt": "2016-06-28T20:00:00Z"
#                     },
#                     {
#                         "count": 229,
#                         "dt": "2016-06-28T21:00:00Z"
#                     },
#                     {
#                         "count": 342,
#                         "dt": "2016-06-28T22:00:00Z"
#                     },
#                     {
#                         "count": 85,
#                         "dt": "2016-06-28T23:00:00Z"
#                     },
#                     {
#                         "count": 32,
#                         "dt": "2016-06-29T11:00:00Z"
#                     },
#                     {
#                         "count": 116,
#                         "dt": "2016-06-29T12:00:00Z"
#                     },
#                     {
#                         "count": 107,
#                         "dt": "2016-06-29T13:00:00Z"
#                     },
#                     {
#                         "count": 238,
#                         "dt": "2016-06-29T14:00:00Z"
#                     },
#                     {
#                         "count": 167,
#                         "dt": "2016-06-29T15:00:00Z"
#                     },
#                     {
#                         "count": 136,
#                         "dt": "2016-06-29T16:00:00Z"
#                     },
#                     {
#                         "count": 149,
#                         "dt": "2016-06-29T17:00:00Z"
#                     },
#                     {
#                         "count": 256,
#                         "dt": "2016-06-29T18:00:00Z"
#                     },
#                     {
#                         "count": 214,
#                         "dt": "2016-06-29T19:00:00Z"
#                     },
#                     {
#                         "count": 129,
#                         "dt": "2016-06-29T20:00:00Z"
#                     },
#                     {
#                         "count": 212,
#                         "dt": "2016-06-29T21:00:00Z"
#                     },
#                     {
#                         "count": 126,
#                         "dt": "2016-06-29T22:00:00Z"
#                     },
#                     {
#                         "count": 228,
#                         "dt": "2016-06-29T23:00:00Z"
#                     },
#                     {
#                         "count": 237,
#                         "dt": "2016-06-30T00:00:00Z"
#                     },
#                     {
#                         "count": 249,
#                         "dt": "2016-06-30T01:00:00Z"
#                     },
#                     {
#                         "count": 145,
#                         "dt": "2016-06-30T02:00:00Z"
#                     },
#                     {
#                         "count": 170,
#                         "dt": "2016-06-30T03:00:00Z"
#                     },
#                     {
#                         "count": 170,
#                         "dt": "2016-06-30T04:00:00Z"
#                     },
#                     {
#                         "count": 143,
#                         "dt": "2016-06-30T05:00:00Z"
#                     },
#                     {
#                         "count": 156,
#                         "dt": "2016-06-30T06:00:00Z"
#                     },
#                     {
#                         "count": 74,
#                         "dt": "2016-06-30T07:00:00Z"
#                     },
#                     {
#                         "count": 34,
#                         "dt": "2016-06-30T08:00:00Z"
#                     },
#                     {
#                         "count": 37,
#                         "dt": "2016-06-30T09:00:00Z"
#                     },
#                     {
#                         "count": 96,
#                         "dt": "2016-06-30T10:00:00Z"
#                     },
#                     {
#                         "count": 122,
#                         "dt": "2016-06-30T11:00:00Z"
#                     },
#                     {
#                         "count": 113,
#                         "dt": "2016-06-30T12:00:00Z"
#                     },
#                     {
#                         "count": 156,
#                         "dt": "2016-06-30T13:00:00Z"
#                     },
#                     {
#                         "count": 166,
#                         "dt": "2016-06-30T14:00:00Z"
#                     },
#                     {
#                         "count": 137,
#                         "dt": "2016-06-30T15:00:00Z"
#                     },
#                     {
#                         "count": 146,
#                         "dt": "2016-06-30T16:00:00Z"
#                     },
#                     {
#                         "count": 172,
#                         "dt": "2016-06-30T17:00:00Z"
#                     },
#                     {
#                         "count": 134,
#                         "dt": "2016-06-30T18:00:00Z"
#                     },
#                     {
#                         "count": 133,
#                         "dt": "2016-06-30T19:00:00Z"
#                     },
#                     {
#                         "count": 156,
#                         "dt": "2016-06-30T20:00:00Z"
#                     },
#                     {
#                         "count": 206,
#                         "dt": "2016-06-30T21:00:00Z"
#                     },
#                     {
#                         "count": 171,
#                         "dt": "2016-06-30T22:00:00Z"
#                     },
#                     {
#                         "count": 232,
#                         "dt": "2016-06-30T23:00:00Z"
#                     },
#                     {
#                         "count": 202,
#                         "dt": "2016-07-01T00:00:00Z"
#                     },
#                     {
#                         "count": 352,
#                         "dt": "2016-07-01T01:00:00Z"
#                     },
#                     {
#                         "count": 229,
#                         "dt": "2016-07-01T02:00:00Z"
#                     },
#                     {
#                         "count": 139,
#                         "dt": "2016-07-01T03:00:00Z"
#                     },
#                     {
#                         "count": 1,
#                         "dt": "2016-07-03T19:00:00Z"
#                     }
#                 ]
#             },
#             {
#                 "_id": "trump2016",
#                 "data": [
#                     {
#                         "count": 123,
#                         "dt": "2016-06-28T18:00:00Z"
#                     },
#                     {
#                         "count": 228,
#                         "dt": "2016-06-28T19:00:00Z"
#                     },
#                     {
#                         "count": 443,
#                         "dt": "2016-06-28T20:00:00Z"
#                     },
#                     {
#                         "count": 1572,
#                         "dt": "2016-06-28T21:00:00Z"
#                     },
#                     {
#                         "count": 816,
#                         "dt": "2016-06-28T22:00:00Z"
#                     },
#                     {
#                         "count": 121,
#                         "dt": "2016-06-28T23:00:00Z"
#                     },
#                     {
#                         "count": 62,
#                         "dt": "2016-06-29T11:00:00Z"
#                     },
#                     {
#                         "count": 254,
#                         "dt": "2016-06-29T12:00:00Z"
#                     },
#                     {
#                         "count": 482,
#                         "dt": "2016-06-29T13:00:00Z"
#                     },
#                     {
#                         "count": 453,
#                         "dt": "2016-06-29T14:00:00Z"
#                     },
#                     {
#                         "count": 388,
#                         "dt": "2016-06-29T15:00:00Z"
#                     },
#                     {
#                         "count": 284,
#                         "dt": "2016-06-29T16:00:00Z"
#                     },
#                     {
#                         "count": 309,
#                         "dt": "2016-06-29T17:00:00Z"
#                     },
#                     {
#                         "count": 237,
#                         "dt": "2016-06-29T18:00:00Z"
#                     },
#                     {
#                         "count": 259,
#                         "dt": "2016-06-29T19:00:00Z"
#                     },
#                     {
#                         "count": 208,
#                         "dt": "2016-06-29T20:00:00Z"
#                     },
#                     {
#                         "count": 415,
#                         "dt": "2016-06-29T21:00:00Z"
#                     },
#                     {
#                         "count": 329,
#                         "dt": "2016-06-29T22:00:00Z"
#                     },
#                     {
#                         "count": 454,
#                         "dt": "2016-06-29T23:00:00Z"
#                     },
#                     {
#                         "count": 400,
#                         "dt": "2016-06-30T00:00:00Z"
#                     },
#                     {
#                         "count": 735,
#                         "dt": "2016-06-30T01:00:00Z"
#                     },
#                     {
#                         "count": 577,
#                         "dt": "2016-06-30T02:00:00Z"
#                     },
#                     {
#                         "count": 468,
#                         "dt": "2016-06-30T03:00:00Z"
#                     },
#                     {
#                         "count": 475,
#                         "dt": "2016-06-30T04:00:00Z"
#                     },
#                     {
#                         "count": 383,
#                         "dt": "2016-06-30T05:00:00Z"
#                     },
#                     {
#                         "count": 224,
#                         "dt": "2016-06-30T06:00:00Z"
#                     },
#                     {
#                         "count": 185,
#                         "dt": "2016-06-30T07:00:00Z"
#                     },
#                     {
#                         "count": 143,
#                         "dt": "2016-06-30T08:00:00Z"
#                     },
#                     {
#                         "count": 141,
#                         "dt": "2016-06-30T09:00:00Z"
#                     },
#                     {
#                         "count": 154,
#                         "dt": "2016-06-30T10:00:00Z"
#                     },
#                     {
#                         "count": 206,
#                         "dt": "2016-06-30T11:00:00Z"
#                     },
#                     {
#                         "count": 269,
#                         "dt": "2016-06-30T12:00:00Z"
#                     },
#                     {
#                         "count": 357,
#                         "dt": "2016-06-30T13:00:00Z"
#                     },
#                     {
#                         "count": 473,
#                         "dt": "2016-06-30T14:00:00Z"
#                     },
#                     {
#                         "count": 405,
#                         "dt": "2016-06-30T15:00:00Z"
#                     },
#                     {
#                         "count": 415,
#                         "dt": "2016-06-30T16:00:00Z"
#                     },
#                     {
#                         "count": 422,
#                         "dt": "2016-06-30T17:00:00Z"
#                     },
#                     {
#                         "count": 265,
#                         "dt": "2016-06-30T18:00:00Z"
#                     },
#                     {
#                         "count": 365,
#                         "dt": "2016-06-30T19:00:00Z"
#                     },
#                     {
#                         "count": 286,
#                         "dt": "2016-06-30T20:00:00Z"
#                     },
#                     {
#                         "count": 268,
#                         "dt": "2016-06-30T21:00:00Z"
#                     },
#                     {
#                         "count": 325,
#                         "dt": "2016-06-30T22:00:00Z"
#                     },
#                     {
#                         "count": 351,
#                         "dt": "2016-06-30T23:00:00Z"
#                     },
#                     {
#                         "count": 318,
#                         "dt": "2016-07-01T00:00:00Z"
#                     },
#                     {
#                         "count": 489,
#                         "dt": "2016-07-01T01:00:00Z"
#                     },
#                     {
#                         "count": 343,
#                         "dt": "2016-07-01T02:00:00Z"
#                     },
#                     {
#                         "count": 177,
#                         "dt": "2016-07-01T03:00:00Z"
#                     }
#                 ]
#             },
#             {
#                 "_id": "bernieorbust",
#                 "data": [
#                     {
#                         "count": 126,
#                         "dt": "2016-06-28T18:00:00Z"
#                     },
#                     {
#                         "count": 260,
#                         "dt": "2016-06-28T19:00:00Z"
#                     },
#                     {
#                         "count": 191,
#                         "dt": "2016-06-28T20:00:00Z"
#                     },
#                     {
#                         "count": 224,
#                         "dt": "2016-06-28T21:00:00Z"
#                     },
#                     {
#                         "count": 408,
#                         "dt": "2016-06-28T22:00:00Z"
#                     },
#                     {
#                         "count": 112,
#                         "dt": "2016-06-28T23:00:00Z"
#                     },
#                     {
#                         "count": 55,
#                         "dt": "2016-06-29T11:00:00Z"
#                     },
#                     {
#                         "count": 166,
#                         "dt": "2016-06-29T12:00:00Z"
#                     },
#                     {
#                         "count": 212,
#                         "dt": "2016-06-29T13:00:00Z"
#                     },
#                     {
#                         "count": 259,
#                         "dt": "2016-06-29T14:00:00Z"
#                     },
#                     {
#                         "count": 339,
#                         "dt": "2016-06-29T15:00:00Z"
#                     },
#                     {
#                         "count": 229,
#                         "dt": "2016-06-29T16:00:00Z"
#                     },
#                     {
#                         "count": 228,
#                         "dt": "2016-06-29T17:00:00Z"
#                     },
#                     {
#                         "count": 452,
#                         "dt": "2016-06-29T18:00:00Z"
#                     },
#                     {
#                         "count": 354,
#                         "dt": "2016-06-29T19:00:00Z"
#                     },
#                     {
#                         "count": 197,
#                         "dt": "2016-06-29T20:00:00Z"
#                     },
#                     {
#                         "count": 259,
#                         "dt": "2016-06-29T21:00:00Z"
#                     },
#                     {
#                         "count": 212,
#                         "dt": "2016-06-29T22:00:00Z"
#                     },
#                     {
#                         "count": 322,
#                         "dt": "2016-06-29T23:00:00Z"
#                     },
#                     {
#                         "count": 274,
#                         "dt": "2016-06-30T00:00:00Z"
#                     },
#                     {
#                         "count": 305,
#                         "dt": "2016-06-30T01:00:00Z"
#                     },
#                     {
#                         "count": 214,
#                         "dt": "2016-06-30T02:00:00Z"
#                     },
#                     {
#                         "count": 208,
#                         "dt": "2016-06-30T03:00:00Z"
#                     },
#                     {
#                         "count": 175,
#                         "dt": "2016-06-30T04:00:00Z"
#                     },
#                     {
#                         "count": 166,
#                         "dt": "2016-06-30T05:00:00Z"
#                     },
#                     {
#                         "count": 171,
#                         "dt": "2016-06-30T06:00:00Z"
#                     },
#                     {
#                         "count": 90,
#                         "dt": "2016-06-30T07:00:00Z"
#                     },
#                     {
#                         "count": 60,
#                         "dt": "2016-06-30T08:00:00Z"
#                     },
#                     {
#                         "count": 128,
#                         "dt": "2016-06-30T09:00:00Z"
#                     },
#                     {
#                         "count": 150,
#                         "dt": "2016-06-30T10:00:00Z"
#                     },
#                     {
#                         "count": 227,
#                         "dt": "2016-06-30T11:00:00Z"
#                     },
#                     {
#                         "count": 188,
#                         "dt": "2016-06-30T12:00:00Z"
#                     },
#                     {
#                         "count": 232,
#                         "dt": "2016-06-30T13:00:00Z"
#                     },
#                     {
#                         "count": 196,
#                         "dt": "2016-06-30T14:00:00Z"
#                     },
#                     {
#                         "count": 192,
#                         "dt": "2016-06-30T15:00:00Z"
#                     },
#                     {
#                         "count": 210,
#                         "dt": "2016-06-30T16:00:00Z"
#                     },
#                     {
#                         "count": 213,
#                         "dt": "2016-06-30T17:00:00Z"
#                     },
#                     {
#                         "count": 215,
#                         "dt": "2016-06-30T18:00:00Z"
#                     },
#                     {
#                         "count": 184,
#                         "dt": "2016-06-30T19:00:00Z"
#                     },
#                     {
#                         "count": 152,
#                         "dt": "2016-06-30T20:00:00Z"
#                     },
#                     {
#                         "count": 260,
#                         "dt": "2016-06-30T21:00:00Z"
#                     },
#                     {
#                         "count": 300,
#                         "dt": "2016-06-30T22:00:00Z"
#                     },
#                     {
#                         "count": 336,
#                         "dt": "2016-06-30T23:00:00Z"
#                     },
#                     {
#                         "count": 239,
#                         "dt": "2016-07-01T00:00:00Z"
#                     },
#                     {
#                         "count": 236,
#                         "dt": "2016-07-01T01:00:00Z"
#                     },
#                     {
#                         "count": 215,
#                         "dt": "2016-07-01T02:00:00Z"
#                     },
#                     {
#                         "count": 145,
#                         "dt": "2016-07-01T03:00:00Z"
#                     },
#                     {
#                         "count": 1,
#                         "dt": "2016-07-03T19:00:00Z"
#                     }
#                 ]
#             },
#             {
#                 "_id": "americafirst",
#                 "data": [
#                     {
#                         "count": 37,
#                         "dt": "2016-06-28T18:00:00Z"
#                     },
#                     {
#                         "count": 108,
#                         "dt": "2016-06-28T19:00:00Z"
#                     },
#                     {
#                         "count": 160,
#                         "dt": "2016-06-28T20:00:00Z"
#                     },
#                     {
#                         "count": 90,
#                         "dt": "2016-06-28T21:00:00Z"
#                     },
#                     {
#                         "count": 149,
#                         "dt": "2016-06-28T22:00:00Z"
#                     },
#                     {
#                         "count": 196,
#                         "dt": "2016-06-28T23:00:00Z"
#                     },
#                     {
#                         "count": 7,
#                         "dt": "2016-06-29T11:00:00Z"
#                     },
#                     {
#                         "count": 148,
#                         "dt": "2016-06-29T12:00:00Z"
#                     },
#                     {
#                         "count": 318,
#                         "dt": "2016-06-29T13:00:00Z"
#                     },
#                     {
#                         "count": 248,
#                         "dt": "2016-06-29T14:00:00Z"
#                     },
#                     {
#                         "count": 186,
#                         "dt": "2016-06-29T15:00:00Z"
#                     },
#                     {
#                         "count": 134,
#                         "dt": "2016-06-29T16:00:00Z"
#                     },
#                     {
#                         "count": 180,
#                         "dt": "2016-06-29T17:00:00Z"
#                     },
#                     {
#                         "count": 133,
#                         "dt": "2016-06-29T18:00:00Z"
#                     },
#                     {
#                         "count": 74,
#                         "dt": "2016-06-29T19:00:00Z"
#                     },
#                     {
#                         "count": 59,
#                         "dt": "2016-06-29T20:00:00Z"
#                     },
#                     {
#                         "count": 78,
#                         "dt": "2016-06-29T21:00:00Z"
#                     },
#                     {
#                         "count": 77,
#                         "dt": "2016-06-29T22:00:00Z"
#                     },
#                     {
#                         "count": 286,
#                         "dt": "2016-06-29T23:00:00Z"
#                     },
#                     {
#                         "count": 94,
#                         "dt": "2016-06-30T00:00:00Z"
#                     },
#                     {
#                         "count": 51,
#                         "dt": "2016-06-30T01:00:00Z"
#                     },
#                     {
#                         "count": 87,
#                         "dt": "2016-06-30T02:00:00Z"
#                     },
#                     {
#                         "count": 33,
#                         "dt": "2016-06-30T03:00:00Z"
#                     },
#                     {
#                         "count": 30,
#                         "dt": "2016-06-30T04:00:00Z"
#                     },
#                     {
#                         "count": 15,
#                         "dt": "2016-06-30T05:00:00Z"
#                     },
#                     {
#                         "count": 12,
#                         "dt": "2016-06-30T06:00:00Z"
#                     },
#                     {
#                         "count": 8,
#                         "dt": "2016-06-30T07:00:00Z"
#                     },
#                     {
#                         "count": 11,
#                         "dt": "2016-06-30T08:00:00Z"
#                     },
#                     {
#                         "count": 7,
#                         "dt": "2016-06-30T09:00:00Z"
#                     },
#                     {
#                         "count": 13,
#                         "dt": "2016-06-30T10:00:00Z"
#                     },
#                     {
#                         "count": 13,
#                         "dt": "2016-06-30T11:00:00Z"
#                     },
#                     {
#                         "count": 21,
#                         "dt": "2016-06-30T12:00:00Z"
#                     },
#                     {
#                         "count": 111,
#                         "dt": "2016-06-30T13:00:00Z"
#                     },
#                     {
#                         "count": 196,
#                         "dt": "2016-06-30T14:00:00Z"
#                     },
#                     {
#                         "count": 174,
#                         "dt": "2016-06-30T15:00:00Z"
#                     },
#                     {
#                         "count": 195,
#                         "dt": "2016-06-30T16:00:00Z"
#                     },
#                     {
#                         "count": 211,
#                         "dt": "2016-06-30T17:00:00Z"
#                     },
#                     {
#                         "count": 106,
#                         "dt": "2016-06-30T18:00:00Z"
#                     },
#                     {
#                         "count": 147,
#                         "dt": "2016-06-30T19:00:00Z"
#                     },
#                     {
#                         "count": 84,
#                         "dt": "2016-06-30T20:00:00Z"
#                     },
#                     {
#                         "count": 110,
#                         "dt": "2016-06-30T21:00:00Z"
#                     },
#                     {
#                         "count": 123,
#                         "dt": "2016-06-30T22:00:00Z"
#                     },
#                     {
#                         "count": 273,
#                         "dt": "2016-06-30T23:00:00Z"
#                     },
#                     {
#                         "count": 143,
#                         "dt": "2016-07-01T00:00:00Z"
#                     },
#                     {
#                         "count": 102,
#                         "dt": "2016-07-01T01:00:00Z"
#                     },
#                     {
#                         "count": 90,
#                         "dt": "2016-07-01T02:00:00Z"
#                     },
#                     {
#                         "count": 67,
#                         "dt": "2016-07-01T03:00:00Z"
#                     }
#                 ]
#             },
#             {
#                 "_id": "stillsanders",
#                 "data": [
#                     {
#                         "count": 84,
#                         "dt": "2016-06-28T18:00:00Z"
#                     },
#                     {
#                         "count": 145,
#                         "dt": "2016-06-28T19:00:00Z"
#                     },
#                     {
#                         "count": 110,
#                         "dt": "2016-06-28T20:00:00Z"
#                     },
#                     {
#                         "count": 243,
#                         "dt": "2016-06-28T21:00:00Z"
#                     },
#                     {
#                         "count": 330,
#                         "dt": "2016-06-28T22:00:00Z"
#                     },
#                     {
#                         "count": 100,
#                         "dt": "2016-06-28T23:00:00Z"
#                     },
#                     {
#                         "count": 51,
#                         "dt": "2016-06-29T11:00:00Z"
#                     },
#                     {
#                         "count": 90,
#                         "dt": "2016-06-29T12:00:00Z"
#                     },
#                     {
#                         "count": 109,
#                         "dt": "2016-06-29T13:00:00Z"
#                     },
#                     {
#                         "count": 136,
#                         "dt": "2016-06-29T14:00:00Z"
#                     },
#                     {
#                         "count": 205,
#                         "dt": "2016-06-29T15:00:00Z"
#                     },
#                     {
#                         "count": 157,
#                         "dt": "2016-06-29T16:00:00Z"
#                     },
#                     {
#                         "count": 139,
#                         "dt": "2016-06-29T17:00:00Z"
#                     },
#                     {
#                         "count": 290,
#                         "dt": "2016-06-29T18:00:00Z"
#                     },
#                     {
#                         "count": 229,
#                         "dt": "2016-06-29T19:00:00Z"
#                     },
#                     {
#                         "count": 162,
#                         "dt": "2016-06-29T20:00:00Z"
#                     },
#                     {
#                         "count": 216,
#                         "dt": "2016-06-29T21:00:00Z"
#                     },
#                     {
#                         "count": 194,
#                         "dt": "2016-06-29T22:00:00Z"
#                     },
#                     {
#                         "count": 295,
#                         "dt": "2016-06-29T23:00:00Z"
#                     },
#                     {
#                         "count": 199,
#                         "dt": "2016-06-30T00:00:00Z"
#                     },
#                     {
#                         "count": 221,
#                         "dt": "2016-06-30T01:00:00Z"
#                     },
#                     {
#                         "count": 121,
#                         "dt": "2016-06-30T02:00:00Z"
#                     },
#                     {
#                         "count": 113,
#                         "dt": "2016-06-30T03:00:00Z"
#                     },
#                     {
#                         "count": 104,
#                         "dt": "2016-06-30T04:00:00Z"
#                     },
#                     {
#                         "count": 138,
#                         "dt": "2016-06-30T05:00:00Z"
#                     },
#                     {
#                         "count": 152,
#                         "dt": "2016-06-30T06:00:00Z"
#                     },
#                     {
#                         "count": 79,
#                         "dt": "2016-06-30T07:00:00Z"
#                     },
#                     {
#                         "count": 33,
#                         "dt": "2016-06-30T08:00:00Z"
#                     },
#                     {
#                         "count": 99,
#                         "dt": "2016-06-30T09:00:00Z"
#                     },
#                     {
#                         "count": 108,
#                         "dt": "2016-06-30T10:00:00Z"
#                     },
#                     {
#                         "count": 98,
#                         "dt": "2016-06-30T11:00:00Z"
#                     },
#                     {
#                         "count": 70,
#                         "dt": "2016-06-30T12:00:00Z"
#                     },
#                     {
#                         "count": 115,
#                         "dt": "2016-06-30T13:00:00Z"
#                     },
#                     {
#                         "count": 119,
#                         "dt": "2016-06-30T14:00:00Z"
#                     },
#                     {
#                         "count": 71,
#                         "dt": "2016-06-30T15:00:00Z"
#                     },
#                     {
#                         "count": 179,
#                         "dt": "2016-06-30T16:00:00Z"
#                     },
#                     {
#                         "count": 206,
#                         "dt": "2016-06-30T17:00:00Z"
#                     },
#                     {
#                         "count": 140,
#                         "dt": "2016-06-30T18:00:00Z"
#                     },
#                     {
#                         "count": 147,
#                         "dt": "2016-06-30T19:00:00Z"
#                     },
#                     {
#                         "count": 149,
#                         "dt": "2016-06-30T20:00:00Z"
#                     },
#                     {
#                         "count": 231,
#                         "dt": "2016-06-30T21:00:00Z"
#                     },
#                     {
#                         "count": 200,
#                         "dt": "2016-06-30T22:00:00Z"
#                     },
#                     {
#                         "count": 219,
#                         "dt": "2016-06-30T23:00:00Z"
#                     },
#                     {
#                         "count": 163,
#                         "dt": "2016-07-01T00:00:00Z"
#                     },
#                     {
#                         "count": 200,
#                         "dt": "2016-07-01T01:00:00Z"
#                     },
#                     {
#                         "count": 220,
#                         "dt": "2016-07-01T02:00:00Z"
#                     },
#                     {
#                         "count": 93,
#                         "dt": "2016-07-01T03:00:00Z"
#                     }
#                 ]
#             },
#             {
#                 "_id": "trumptrain",
#                 "data": [
#                     {
#                         "count": 62,
#                         "dt": "2016-06-28T18:00:00Z"
#                     },
#                     {
#                         "count": 124,
#                         "dt": "2016-06-28T19:00:00Z"
#                     },
#                     {
#                         "count": 121,
#                         "dt": "2016-06-28T20:00:00Z"
#                     },
#                     {
#                         "count": 108,
#                         "dt": "2016-06-28T21:00:00Z"
#                     },
#                     {
#                         "count": 208,
#                         "dt": "2016-06-28T22:00:00Z"
#                     },
#                     {
#                         "count": 83,
#                         "dt": "2016-06-28T23:00:00Z"
#                     },
#                     {
#                         "count": 39,
#                         "dt": "2016-06-29T11:00:00Z"
#                     },
#                     {
#                         "count": 179,
#                         "dt": "2016-06-29T12:00:00Z"
#                     },
#                     {
#                         "count": 232,
#                         "dt": "2016-06-29T13:00:00Z"
#                     },
#                     {
#                         "count": 228,
#                         "dt": "2016-06-29T14:00:00Z"
#                     },
#                     {
#                         "count": 178,
#                         "dt": "2016-06-29T15:00:00Z"
#                     },
#                     {
#                         "count": 161,
#                         "dt": "2016-06-29T16:00:00Z"
#                     },
#                     {
#                         "count": 212,
#                         "dt": "2016-06-29T17:00:00Z"
#                     },
#                     {
#                         "count": 233,
#                         "dt": "2016-06-29T18:00:00Z"
#                     },
#                     {
#                         "count": 160,
#                         "dt": "2016-06-29T19:00:00Z"
#                     },
#                     {
#                         "count": 112,
#                         "dt": "2016-06-29T20:00:00Z"
#                     },
#                     {
#                         "count": 213,
#                         "dt": "2016-06-29T21:00:00Z"
#                     },
#                     {
#                         "count": 344,
#                         "dt": "2016-06-29T22:00:00Z"
#                     },
#                     {
#                         "count": 309,
#                         "dt": "2016-06-29T23:00:00Z"
#                     },
#                     {
#                         "count": 191,
#                         "dt": "2016-06-30T00:00:00Z"
#                     },
#                     {
#                         "count": 223,
#                         "dt": "2016-06-30T01:00:00Z"
#                     },
#                     {
#                         "count": 203,
#                         "dt": "2016-06-30T02:00:00Z"
#                     },
#                     {
#                         "count": 180,
#                         "dt": "2016-06-30T03:00:00Z"
#                     },
#                     {
#                         "count": 278,
#                         "dt": "2016-06-30T04:00:00Z"
#                     },
#                     {
#                         "count": 230,
#                         "dt": "2016-06-30T05:00:00Z"
#                     },
#                     {
#                         "count": 122,
#                         "dt": "2016-06-30T06:00:00Z"
#                     },
#                     {
#                         "count": 106,
#                         "dt": "2016-06-30T07:00:00Z"
#                     },
#                     {
#                         "count": 116,
#                         "dt": "2016-06-30T08:00:00Z"
#                     },
#                     {
#                         "count": 91,
#                         "dt": "2016-06-30T09:00:00Z"
#                     },
#                     {
#                         "count": 73,
#                         "dt": "2016-06-30T10:00:00Z"
#                     },
#                     {
#                         "count": 105,
#                         "dt": "2016-06-30T11:00:00Z"
#                     },
#                     {
#                         "count": 119,
#                         "dt": "2016-06-30T12:00:00Z"
#                     },
#                     {
#                         "count": 203,
#                         "dt": "2016-06-30T13:00:00Z"
#                     },
#                     {
#                         "count": 265,
#                         "dt": "2016-06-30T14:00:00Z"
#                     },
#                     {
#                         "count": 140,
#                         "dt": "2016-06-30T15:00:00Z"
#                     },
#                     {
#                         "count": 150,
#                         "dt": "2016-06-30T16:00:00Z"
#                     },
#                     {
#                         "count": 128,
#                         "dt": "2016-06-30T17:00:00Z"
#                     },
#                     {
#                         "count": 122,
#                         "dt": "2016-06-30T18:00:00Z"
#                     },
#                     {
#                         "count": 131,
#                         "dt": "2016-06-30T19:00:00Z"
#                     },
#                     {
#                         "count": 112,
#                         "dt": "2016-06-30T20:00:00Z"
#                     },
#                     {
#                         "count": 120,
#                         "dt": "2016-06-30T21:00:00Z"
#                     },
#                     {
#                         "count": 398,
#                         "dt": "2016-06-30T22:00:00Z"
#                     },
#                     {
#                         "count": 325,
#                         "dt": "2016-06-30T23:00:00Z"
#                     },
#                     {
#                         "count": 208,
#                         "dt": "2016-07-01T00:00:00Z"
#                     },
#                     {
#                         "count": 217,
#                         "dt": "2016-07-01T01:00:00Z"
#                     },
#                     {
#                         "count": 207,
#                         "dt": "2016-07-01T02:00:00Z"
#                     },
#                     {
#                         "count": 112,
#                         "dt": "2016-07-01T03:00:00Z"
#                     }
#                 ]
#             },
#             {
#                 "_id": "feelthebern",
#                 "data": [
#                     {
#                         "count": 724,
#                         "dt": "2016-06-28T18:00:00Z"
#                     },
#                     {
#                         "count": 1265,
#                         "dt": "2016-06-28T19:00:00Z"
#                     },
#                     {
#                         "count": 1047,
#                         "dt": "2016-06-28T20:00:00Z"
#                     },
#                     {
#                         "count": 2326,
#                         "dt": "2016-06-28T21:00:00Z"
#                     },
#                     {
#                         "count": 1832,
#                         "dt": "2016-06-28T22:00:00Z"
#                     },
#                     {
#                         "count": 568,
#                         "dt": "2016-06-28T23:00:00Z"
#                     },
#                     {
#                         "count": 263,
#                         "dt": "2016-06-29T11:00:00Z"
#                     },
#                     {
#                         "count": 715,
#                         "dt": "2016-06-29T12:00:00Z"
#                     },
#                     {
#                         "count": 824,
#                         "dt": "2016-06-29T13:00:00Z"
#                     },
#                     {
#                         "count": 1072,
#                         "dt": "2016-06-29T14:00:00Z"
#                     },
#                     {
#                         "count": 995,
#                         "dt": "2016-06-29T15:00:00Z"
#                     },
#                     {
#                         "count": 955,
#                         "dt": "2016-06-29T16:00:00Z"
#                     },
#                     {
#                         "count": 852,
#                         "dt": "2016-06-29T17:00:00Z"
#                     },
#                     {
#                         "count": 1108,
#                         "dt": "2016-06-29T18:00:00Z"
#                     },
#                     {
#                         "count": 983,
#                         "dt": "2016-06-29T19:00:00Z"
#                     },
#                     {
#                         "count": 916,
#                         "dt": "2016-06-29T20:00:00Z"
#                     },
#                     {
#                         "count": 893,
#                         "dt": "2016-06-29T21:00:00Z"
#                     },
#                     {
#                         "count": 739,
#                         "dt": "2016-06-29T22:00:00Z"
#                     },
#                     {
#                         "count": 964,
#                         "dt": "2016-06-29T23:00:00Z"
#                     },
#                     {
#                         "count": 968,
#                         "dt": "2016-06-30T00:00:00Z"
#                     },
#                     {
#                         "count": 890,
#                         "dt": "2016-06-30T01:00:00Z"
#                     },
#                     {
#                         "count": 913,
#                         "dt": "2016-06-30T02:00:00Z"
#                     },
#                     {
#                         "count": 753,
#                         "dt": "2016-06-30T03:00:00Z"
#                     },
#                     {
#                         "count": 622,
#                         "dt": "2016-06-30T04:00:00Z"
#                     },
#                     {
#                         "count": 511,
#                         "dt": "2016-06-30T05:00:00Z"
#                     },
#                     {
#                         "count": 480,
#                         "dt": "2016-06-30T06:00:00Z"
#                     },
#                     {
#                         "count": 372,
#                         "dt": "2016-06-30T07:00:00Z"
#                     },
#                     {
#                         "count": 278,
#                         "dt": "2016-06-30T08:00:00Z"
#                     },
#                     {
#                         "count": 356,
#                         "dt": "2016-06-30T09:00:00Z"
#                     },
#                     {
#                         "count": 432,
#                         "dt": "2016-06-30T10:00:00Z"
#                     },
#                     {
#                         "count": 525,
#                         "dt": "2016-06-30T11:00:00Z"
#                     },
#                     {
#                         "count": 543,
#                         "dt": "2016-06-30T12:00:00Z"
#                     },
#                     {
#                         "count": 700,
#                         "dt": "2016-06-30T13:00:00Z"
#                     },
#                     {
#                         "count": 763,
#                         "dt": "2016-06-30T14:00:00Z"
#                     },
#                     {
#                         "count": 736,
#                         "dt": "2016-06-30T15:00:00Z"
#                     },
#                     {
#                         "count": 835,
#                         "dt": "2016-06-30T16:00:00Z"
#                     },
#                     {
#                         "count": 909,
#                         "dt": "2016-06-30T17:00:00Z"
#                     },
#                     {
#                         "count": 851,
#                         "dt": "2016-06-30T18:00:00Z"
#                     },
#                     {
#                         "count": 900,
#                         "dt": "2016-06-30T19:00:00Z"
#                     },
#                     {
#                         "count": 679,
#                         "dt": "2016-06-30T20:00:00Z"
#                     },
#                     {
#                         "count": 783,
#                         "dt": "2016-06-30T21:00:00Z"
#                     },
#                     {
#                         "count": 940,
#                         "dt": "2016-06-30T22:00:00Z"
#                     },
#                     {
#                         "count": 931,
#                         "dt": "2016-06-30T23:00:00Z"
#                     },
#                     {
#                         "count": 925,
#                         "dt": "2016-07-01T00:00:00Z"
#                     },
#                     {
#                         "count": 968,
#                         "dt": "2016-07-01T01:00:00Z"
#                     },
#                     {
#                         "count": 853,
#                         "dt": "2016-07-01T02:00:00Z"
#                     },
#                     {
#                         "count": 571,
#                         "dt": "2016-07-01T03:00:00Z"
#                     },
#                     {
#                         "count": 1,
#                         "dt": "2016-07-01T08:00:00Z"
#                     }
#                 ]
#             },
#             {
#                 "_id": "imwithher",
#                 "data": [
#                     {
#                         "count": 582,
#                         "dt": "2016-06-28T18:00:00Z"
#                     },
#                     {
#                         "count": 1401,
#                         "dt": "2016-06-28T19:00:00Z"
#                     },
#                     {
#                         "count": 1343,
#                         "dt": "2016-06-28T20:00:00Z"
#                     },
#                     {
#                         "count": 2645,
#                         "dt": "2016-06-28T21:00:00Z"
#                     },
#                     {
#                         "count": 1843,
#                         "dt": "2016-06-28T22:00:00Z"
#                     },
#                     {
#                         "count": 597,
#                         "dt": "2016-06-28T23:00:00Z"
#                     },
#                     {
#                         "count": 288,
#                         "dt": "2016-06-29T11:00:00Z"
#                     },
#                     {
#                         "count": 692,
#                         "dt": "2016-06-29T12:00:00Z"
#                     },
#                     {
#                         "count": 705,
#                         "dt": "2016-06-29T13:00:00Z"
#                     },
#                     {
#                         "count": 873,
#                         "dt": "2016-06-29T14:00:00Z"
#                     },
#                     {
#                         "count": 1036,
#                         "dt": "2016-06-29T15:00:00Z"
#                     },
#                     {
#                         "count": 1248,
#                         "dt": "2016-06-29T16:00:00Z"
#                     },
#                     {
#                         "count": 2307,
#                         "dt": "2016-06-29T17:00:00Z"
#                     },
#                     {
#                         "count": 1332,
#                         "dt": "2016-06-29T18:00:00Z"
#                     },
#                     {
#                         "count": 1412,
#                         "dt": "2016-06-29T19:00:00Z"
#                     },
#                     {
#                         "count": 1239,
#                         "dt": "2016-06-29T20:00:00Z"
#                     },
#                     {
#                         "count": 1201,
#                         "dt": "2016-06-29T21:00:00Z"
#                     },
#                     {
#                         "count": 1304,
#                         "dt": "2016-06-29T22:00:00Z"
#                     },
#                     {
#                         "count": 1411,
#                         "dt": "2016-06-29T23:00:00Z"
#                     },
#                     {
#                         "count": 1524,
#                         "dt": "2016-06-30T00:00:00Z"
#                     },
#                     {
#                         "count": 1685,
#                         "dt": "2016-06-30T01:00:00Z"
#                     },
#                     {
#                         "count": 2202,
#                         "dt": "2016-06-30T02:00:00Z"
#                     },
#                     {
#                         "count": 1096,
#                         "dt": "2016-06-30T03:00:00Z"
#                     },
#                     {
#                         "count": 984,
#                         "dt": "2016-06-30T04:00:00Z"
#                     },
#                     {
#                         "count": 431,
#                         "dt": "2016-06-30T05:00:00Z"
#                     },
#                     {
#                         "count": 368,
#                         "dt": "2016-06-30T06:00:00Z"
#                     },
#                     {
#                         "count": 252,
#                         "dt": "2016-06-30T07:00:00Z"
#                     },
#                     {
#                         "count": 152,
#                         "dt": "2016-06-30T08:00:00Z"
#                     },
#                     {
#                         "count": 213,
#                         "dt": "2016-06-30T09:00:00Z"
#                     },
#                     {
#                         "count": 314,
#                         "dt": "2016-06-30T10:00:00Z"
#                     },
#                     {
#                         "count": 477,
#                         "dt": "2016-06-30T11:00:00Z"
#                     },
#                     {
#                         "count": 567,
#                         "dt": "2016-06-30T12:00:00Z"
#                     },
#                     {
#                         "count": 773,
#                         "dt": "2016-06-30T13:00:00Z"
#                     },
#                     {
#                         "count": 701,
#                         "dt": "2016-06-30T14:00:00Z"
#                     },
#                     {
#                         "count": 814,
#                         "dt": "2016-06-30T15:00:00Z"
#                     },
#                     {
#                         "count": 857,
#                         "dt": "2016-06-30T16:00:00Z"
#                     },
#                     {
#                         "count": 943,
#                         "dt": "2016-06-30T17:00:00Z"
#                     },
#                     {
#                         "count": 927,
#                         "dt": "2016-06-30T18:00:00Z"
#                     },
#                     {
#                         "count": 934,
#                         "dt": "2016-06-30T19:00:00Z"
#                     },
#                     {
#                         "count": 1033,
#                         "dt": "2016-06-30T20:00:00Z"
#                     },
#                     {
#                         "count": 1081,
#                         "dt": "2016-06-30T21:00:00Z"
#                     },
#                     {
#                         "count": 1192,
#                         "dt": "2016-06-30T22:00:00Z"
#                     },
#                     {
#                         "count": 905,
#                         "dt": "2016-06-30T23:00:00Z"
#                     },
#                     {
#                         "count": 1085,
#                         "dt": "2016-07-01T00:00:00Z"
#                     },
#                     {
#                         "count": 1257,
#                         "dt": "2016-07-01T01:00:00Z"
#                     },
#                     {
#                         "count": 1119,
#                         "dt": "2016-07-01T02:00:00Z"
#                     },
#                     {
#                         "count": 615,
#                         "dt": "2016-07-01T03:00:00Z"
#                     },
#                     {
#                         "count": 3,
#                         "dt": "2016-07-01T08:00:00Z"
#                     },
#                     {
#                         "count": 1,
#                         "dt": "2016-07-03T19:00:00Z"
#                     }
#                 ]
#             }
#         ]
#     },
#     "details": {
#         "chartType": "zoomline",
#         "chartProperties":{"yAxisName":"Tweets per minute",
#                            "xAxisName":"Date (UTC)",
#                            "caption":"Blah"}
#     }
# }
#


def CreateTimeDate(chartData):
    x_categories = [{"label": i} for i in chartData["data"]["categories"]]
    values = OrderedDict.fromkeys(chartData["data"]["categories"], 0)

    series = []
    for s in chartData["data"]["values"]:
        for entry in s["data"]:
            values[entry["dt"]] = entry["count"]
        series.append({"seriesname": s["_id"], "data": [{"value": j} for (i, j) in values.items()]})
        values = OrderedDict.fromkeys(chartData["data"]["categories"], 0)

    chartData["details"]["chartProperties"]["drawAnchors"] = 0
    chartData["details"]["chartProperties"]["labelStep"] = 6
    chartData["details"]["chartProperties"]["slantLabels"] = 1
    chartData["details"]["chartProperties"]["showValues"] = "0"

    return GetHTML({"chart": chartData["details"]["chartProperties"], "dataset": series, "categories": {
        "category": x_categories}}, "msline")


def CreatePieChart(chartData):
    plot_data = [{"label": i["_id"], "value": i["count"]} for i in chartData["data"]]
    chartData["details"]["startingAngle"] = "310"
    chartData["details"]["decimals"] = "0"
    chartData["details"]["showLegend"] = "1"
    chartData["details"]["labelFontColor"] = "#FFFFFF"
    chartData["details"]["chartProperties"]["labelFontSize"] = "20"
    chartData["details"]["chartProperties"]["centerLabelColor"] = "#FFFFFF"
    chartData["details"]["chartProperties"]["centerLabelFontSize"] = "30"
    return GetHTML({"chart": chartData["details"]["chartProperties"], "data": plot_data}, "doughnut2d")


def CreateRankingChart(chartData):
    plot_data = [{"label": i["_id"], "value": i["count"]} for i in chartData["data"]]
    return GetHTML({"chart": chartData["details"]["chartProperties"], "data": plot_data}, "bar2d")


def GetHTML(dataSource, type, width=1920, height=1080):
    default_chart_properties = {
        "bgColor": "#000000,#000000",
        "canvasBgAlpha": "0",
        "bgAlpha": "100",
        "theme": "fint",
        "exportEnabled": "1",
        "captionFont": "Verdana",
        "captionFontSize": "30",
        "captionFontColor": "#FFFFFF",
        "captionFontBold": "1",
        "subcaptionFont": "Verdana",
        "subcaptionFontSize": "25",
        "subcaptionFontColor": "#FFFFFF",
        "subcaptionFontBold": "0",
        "baseFont": "Verdana",
        "baseFontSize": "20",
        "baseFontColor": "#FFFFFF",
        "plotFillAlpha": "50",
        "plotHighlightEffect": "fadeout",
        "legendItemFontSize": "20",
        "legendItemFontColor": "#666666",
    }
    for property in default_chart_properties:
        if property not in dataSource["chart"]:
            dataSource["chart"][property] = default_chart_properties[property]

    logger.info("Using chart format: " + str(dataSource["chart"]))

    s = Template(open(os.path.join(DIR_NAME, "Templates", "Chart.html")).read())
    return s.safe_substitute({'dataSource': json.dumps(dataSource, default=AnalyticsService.Util.date_encoder),
                              "height": height,
                              "width": width,
                              "type": type})


def CreateChart(data):
    options = {
        "msline": CreateTimeDate,
        "bar2d": CreateRankingChart,
        "doughnut2d": CreatePieChart
    }
    return options[data["details"]["chartType"]](data)

#
# with open("out.html", "w") as f:
# #     f.write(CreateChart(d))
#
# import codecs
# with codecs.open("out.dat","w",encoding="utf-8") as f:
#     f.write("u'input'"
    #
    # )
if __name__ == "__main__":

    from AnalyticsService.TwitterObj import Status
    from pymongo import MongoClient

    schema_id = "RAW"
    hashtag_key = Status.SCHEMA_MAP[schema_id]["hashtags"]
    limit  =10
    top_user_query = [
        {"$unwind": "$" + hashtag_key},
        {"$group": {"_id": {"$toLower": '$' + hashtag_key + '.' + 'text'}, "count": {"$sum": 1}}},
        {"$sort": {"count": -1}},
        {"$limit": limit}]

    c = MongoClient().get_database("DATA").get_collection("Trump_Clinton_Saunders_old").aggregate(top_user_query,
                                                                                              allowDiskUse = True)
    c = list(c)
    result = {"details": {"chartType": "bar2d",
                          "chartProperties": {"yAxisName": "Number of Occurences",
                                              "xAxisName": "Hashtag",
                                              "caption": "Top " + str(limit) + " hashtags"}},
              "data": c}

    html = CreateChart(result)
    with open("out.html", "w") as f:
        f.write(html)
